<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bowling Brothers</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23ff3366' stroke-width='2'><circle cx='12' cy='12' r='10'/><circle cx='12' cy='12' r='3'/><circle cx='12' cy='8' r='1'/><circle cx='8' cy='14' r='1'/><circle cx='16' cy='14' r='1'/></svg>">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <style>
        /* ========== RESET & VARI√ÅVEIS ========== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-dark: #0a0a0a;
            --bg-card: #1a1a1a;
            --bg-hover: #252525;
            --primary: #ff3366;
            --primary-hover: #ff5580;
            --secondary: #00d9ff;
            --text: #e5e5e5;
            --text-muted: #999;
            --border: #333;
            --success: #00ff88;
            --warning: #ffaa00;
            --error: #ff3366;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--bg-dark);
            color: var(--text);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* ========== NAVBAR ========== */
        .navbar {
            background: var(--bg-card);
            border-bottom: 2px solid var(--primary);
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(255, 51, 102, 0.2);
        }

        .navbar-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }

        .logo svg {
            width: 32px;
            height: 32px;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            list-style: none;
        }

        .nav-links a {
            color: var(--text);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
            cursor: pointer;
        }

        .nav-links a:hover,
        .nav-links a.active {
            color: var(--primary);
        }

        /* ========== CONTAINER PRINCIPAL ========== */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            width: 100%;
            box-sizing: border-box;
        }

        .section {
            display: none;
            animation: fadeIn 0.5s;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ========== CABE√áALHOS ========== */
        .section-header {
            margin-bottom: 2rem;
        }

        .section-header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .section-header h1 svg {
            stroke: url(#iconGradient);
            flex-shrink: 0;
        }

        .section-header h2 {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .section-header h2 svg {
            color: var(--primary);
            flex-shrink: 0;
        }

        .section-header p {
            color: var(--text-muted);
            font-size: 1.1rem;
        }

        /* ========== CARDS ========== */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(255, 51, 102, 0.3);
            border-color: var(--primary);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .card-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--text);
        }

        .card-actions {
            display: flex;
            gap: 0.5rem;
        }

        .card-body {
            color: var(--text-muted);
        }

        .card-stat {
            display: flex;
            justify-content: space-between;
            margin: 0.5rem 0;
        }

        .card-stat-label {
            color: var(--text-muted);
        }

        .card-stat-value {
            color: var(--text);
            font-weight: 600;
        }

        /* ========== BOT√ïES ========== */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), #ff5580);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 51, 102, 0.4);
        }

        .btn-secondary {
            background: var(--bg-hover);
            color: var(--text);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--border);
            border-color: var(--primary);
        }

        .btn-icon {
            background: transparent;
            padding: 0.5rem;
            border-radius: 6px;
            color: var(--text-muted);
        }

        .btn-icon:hover {
            background: var(--bg-hover);
            color: var(--primary);
        }

        .btn-icon svg {
            width: 20px;
            height: 20px;
        }

        /* ========== FORMUL√ÅRIOS ========== */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text);
        }

        .form-control {
            width: 100%;
            padding: 0.75rem 1rem;
            background: var(--bg-hover);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(255, 51, 102, 0.1);
        }

        /* ========== MODAL ========== */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalSlideIn 0.3s;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text);
        }

        .modal-close {
            background: transparent;
            border: none;
            color: var(--text-muted);
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.3s;
        }

        .modal-close:hover {
            color: var(--primary);
        }

        .modal-footer {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
        }

        /* ========== STATS CARDS ========== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            margin: 0 auto 1rem;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        /* ========== EMPTY STATE ========== */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            max-width: 500px;
            margin: 0 auto;
            grid-column: 1 / -1;
        }

        .empty-state svg {
            width: 120px;
            height: 120px;
            margin-bottom: 1.5rem;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: var(--text-muted);
        }

        .empty-state p {
            color: var(--text-muted);
            margin-bottom: 1.5rem;
        }

        /* ========== RESPONSIVE ========== */
        @media (max-width: 768px) {
            .navbar-content {
                flex-direction: column;
                gap: 1rem;
                padding: 1rem;
            }

            .nav-links {
                gap: 1rem;
                flex-wrap: wrap;
                justify-content: center;
            }

            .section-header h1 {
                font-size: 2rem;
            }

            .cards-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        /* ========== LOADING ========== */
        .loading {
            text-align: center;
            padding: 2rem;
            color: var(--text-muted);
        }

        .spinner {
            border: 3px solid var(--border);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ========== TOAST NOTIFICATIONS ========== */
        .toast-container {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 3000;
        }

        .toast {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-left: 4px solid var(--primary);
            border-radius: 8px;
            padding: 1rem 1.5rem;
            margin-bottom: 1rem;
            min-width: 300px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            animation: toastSlideIn 0.3s;
        }

        @keyframes toastSlideIn {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .toast.success {
            border-left-color: var(--success);
        }

        .toast.error {
            border-left-color: var(--error);
        }

        .toast.warning {
            border-left-color: var(--warning);
        }

        /* ========== FRAMES SCORECARD ========== */
        .frames-container {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 2rem 0;
            overflow-x: auto;
        }

        .scorecard {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 0.5rem;
            min-width: 800px;
        }

        .frame-box {
            background: var(--bg-hover);
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 0.75rem;
            text-align: center;
            transition: all 0.3s;
        }

        .frame-box:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .frame-box.strike {
            border-color: var(--success);
            background: linear-gradient(135deg, var(--bg-hover), rgba(0, 255, 136, 0.1));
        }

        .frame-box.spare {
            border-color: var(--secondary);
            background: linear-gradient(135deg, var(--bg-hover), rgba(0, 217, 255, 0.1));
        }

        .frame-number {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .frame-rolls {
            display: flex;
            justify-content: center;
            gap: 0.25rem;
            margin-bottom: 0.5rem;
            min-height: 30px;
        }

        .roll {
            width: 28px;
            height: 28px;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text);
        }

        .roll.strike {
            background: var(--success);
            color: var(--bg-dark);
        }

        .roll.spare {
            background: var(--secondary);
            color: var(--bg-dark);
        }

        .frame-score {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--primary);
            padding-top: 0.5rem;
            border-top: 1px solid var(--border);
        }

        .frame-input-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 1rem;
            margin-top: 1rem;
        }

        .frame-input-box {
            background: var(--bg-hover);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
        }

        .frame-input-box label {
            display: block;
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-bottom: 0.5rem;
        }

        .frame-input-box input {
            width: 100%;
            padding: 0.5rem;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text);
            text-align: center;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .frame-input-box input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .roll-buttons {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 0.5rem;
            margin: 1rem 0;
        }

        .roll-btn {
            padding: 0.75rem;
            background: var(--bg-hover);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .roll-btn:hover {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        .roll-btn.selected {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        /* ========== GR√ÅFICOS ========== */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }

        .chart-container {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
        }

        .chart-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text);
        }

        .chart-wrapper {
            position: relative;
            height: 300px;
        }

        .chart-wrapper canvas {
            max-height: 100%;
        }

        /* ========== STATS DETAIL ========== */
        .stats-detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .stat-detail-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
        }

        .stat-detail-card h3 {
            font-size: 1rem;
            color: var(--text-muted);
            margin-bottom: 0.5rem;
        }

        .stat-detail-card .value {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-detail-card .label {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-top: 0.5rem;
        }

        /* ========== RANKING TABLE ========== */
        .ranking-table {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
            margin: 2rem 0;
        }

        .ranking-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .ranking-table th {
            background: var(--bg-hover);
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: var(--text);
            border-bottom: 2px solid var(--primary);
        }

        .ranking-table td {
            padding: 1rem;
            border-bottom: 1px solid var(--border);
            color: var(--text);
        }

        .ranking-table tr:hover {
            background: var(--bg-hover);
        }

        .ranking-position {
            width: 50px;
            text-align: center;
            font-weight: 700;
            font-size: 1.2rem;
        }

        .ranking-position.first {
            color: #ffd700;
        }

        .ranking-position.second {
            color: #c0c0c0;
        }

        .ranking-position.third {
            color: #cd7f32;
        }

        /* ========== FILTERS ========== */
        .filters-bar {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-group {
            flex: 1;
            min-width: 200px;
        }

        .filter-group label {
            display: block;
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-bottom: 0.5rem;
        }

        .filter-group select,
        .filter-group input {
            width: 100%;
            padding: 0.5rem;
            background: var(--bg-hover);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text);
            font-family: 'Poppins', sans-serif;
        }

        .filter-actions {
            display: flex;
            gap: 0.5rem;
        }

        /* ========== PLAYER CHECKBOXES ========== */
        .player-checkbox-item {
            display: flex;
            align-items: center;
            padding: 0.5rem;
            margin: 0.25rem 0;
            border-radius: 6px;
            transition: background 0.3s;
        }

        .player-checkbox-item:hover {
            background: var(--bg-dark);
        }

        .player-checkbox-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 0.75rem;
            cursor: pointer;
            accent-color: var(--primary);
        }

        .player-checkbox-item label {
            cursor: pointer;
            flex: 1;
            color: var(--text);
            font-weight: 500;
        }

        .player-frames-section {
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ========== RESPONSIVE CHARTS ========== */
        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }

            .scorecard {
                grid-template-columns: repeat(5, 1fr);
            }

            .frame-input-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .roll-buttons {
                grid-template-columns: repeat(4, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- Defini√ß√£o de gradiente para SVGs -->
    <svg style="width: 0; height: 0; position: absolute;">
        <defs>
            <linearGradient id="iconGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#ff3366;stop-opacity:1" />
                <stop offset="100%" style="stop-color:#00d9ff;stop-opacity:1" />
            </linearGradient>
        </defs>
    </svg>
    
    <!-- ========== NAVBAR ========== -->
    <nav class="navbar">
        <div class="navbar-content">
            <div class="logo">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"/>
                    <circle cx="12" cy="12" r="3"/>
                    <circle cx="12" cy="8" r="1"/>
                    <circle cx="8" cy="14" r="1"/>
                    <circle cx="16" cy="14" r="1"/>
                </svg>
                <span>Bowling Brothers</span>
            </div>
            <ul class="nav-links">
                <li><a href="#" data-section="home" class="active">In√≠cio</a></li>
                <li><a href="#" data-section="players">Jogadores</a></li>
                <li><a href="#" data-section="games">Partidas</a></li>
                <li><a href="#" data-section="stats">Estat√≠sticas</a></li>
            </ul>
        </div>
    </nav>

    <!-- ========== CONTAINER PRINCIPAL ========== -->
    <div class="container">
        <!-- ========== SE√á√ÉO: IN√çCIO ========== -->
        <section id="home" class="section active">
            <div class="section-header">
                <h1>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width: 1em; height: 1em; vertical-align: -0.125em; display: inline-block;">
                        <circle cx="12" cy="12" r="10"/>
                        <circle cx="12" cy="12" r="3"/>
                        <circle cx="12" cy="8" r="1"/>
                        <circle cx="8" cy="14" r="1"/>
                        <circle cx="16" cy="14" r="1"/>
                    </svg>
                    Bem-vindo ao Bowling Brothers
                </h1>
                <p>Sistema completo para gerenciar e acompanhar suas partidas de boliche</p>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--primary)">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                            <circle cx="9" cy="7" r="4"/>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                        </svg>
                    </div>
                    <div class="stat-value" id="totalPlayers">0</div>
                    <div class="stat-label">Jogadores</div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--secondary)">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                            <line x1="9" y1="3" x2="9" y2="21"/>
                            <line x1="15" y1="3" x2="15" y2="21"/>
                            <line x1="3" y1="9" x2="21" y2="9"/>
                            <line x1="3" y1="15" x2="21" y2="15"/>
                        </svg>
                    </div>
                    <div class="stat-value" id="totalGames">0</div>
                    <div class="stat-label">Partidas</div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--success)">
                            <line x1="12" y1="20" x2="12" y2="10"/>
                            <line x1="18" y1="20" x2="18" y2="4"/>
                            <line x1="6" y1="20" x2="6" y2="16"/>
                        </svg>
                    </div>
                    <div class="stat-value" id="avgScore">0</div>
                    <div class="stat-label">M√©dia Geral</div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--warning)">
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                        </svg>
                    </div>
                    <div class="stat-value" id="bestScore">0</div>
                    <div class="stat-label">Melhor Score</div>
                </div>
            </div>

            <div class="section-header">
                <h2>√öltimas Partidas</h2>
            </div>
            <div id="recentGames" class="cards-grid">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Carregando partidas...</p>
                </div>
            </div>
        </section>

        <!-- ========== SE√á√ÉO: JOGADORES ========== -->
        <section id="players" class="section">
            <div class="section-header">
                <h1>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width: 1em; height: 1em; vertical-align: -0.125em; display: inline-block;">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                        <circle cx="9" cy="7" r="4"/>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                    </svg>
                    Jogadores
                </h1>
                <p>Gerencie os jogadores do Bowling Brothers</p>
            </div>

            <button class="btn btn-primary" onclick="openPlayerModal()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width: 20px; height: 20px;">
                    <line x1="12" y1="5" x2="12" y2="19"/>
                    <line x1="5" y1="12" x2="19" y2="12"/>
                </svg>
                Adicionar Jogador
            </button>

            <div id="playersList" class="cards-grid">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Carregando jogadores...</p>
                </div>
            </div>
        </section>

        <!-- ========== SE√á√ÉO: PARTIDAS ========== -->
        <section id="games" class="section">
            <div class="section-header">
                <h1>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width: 1em; height: 1em; vertical-align: -0.125em; display: inline-block;">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M12 6v6l4 2"/>
                    </svg>
                    Partidas
                </h1>
                <p>Registre e acompanhe suas partidas</p>
            </div>

            <button class="btn btn-primary" onclick="openGameModal()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width: 20px; height: 20px;">
                    <line x1="12" y1="5" x2="12" y2="19"/>
                    <line x1="5" y1="12" x2="19" y2="12"/>
                </svg>
                Nova Partida
            </button>

            <div id="gamesList" class="cards-grid">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Carregando partidas...</p>
                </div>
            </div>
        </section>

        <!-- ========== SE√á√ÉO: ESTAT√çSTICAS ========== -->
        <section id="stats" class="section">
            <div class="section-header">
                <h1>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width: 1em; height: 1em; vertical-align: -0.125em; display: inline-block;">
                        <line x1="18" y1="20" x2="18" y2="10"/>
                        <line x1="12" y1="20" x2="12" y2="4"/>
                        <line x1="6" y1="20" x2="6" y2="14"/>
                    </svg>
                    Estat√≠sticas
                </h1>
                <p>An√°lise detalhada do desempenho</p>
            </div>

            <!-- Filtros -->
            <div class="filters-bar">
                <div class="filter-group">
                    <label>Jogador</label>
                    <select id="statsPlayerFilter" onchange="updateStatsView()">
                        <option value="">Todos os jogadores</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Data In√≠cio</label>
                    <input type="date" id="statsDateFrom" onchange="updateStatsView()">
                </div>
                <div class="filter-group">
                    <label>Data Fim</label>
                    <input type="date" id="statsDateTo" onchange="updateStatsView()">
                </div>
                <div class="filter-actions">
                    <button class="btn btn-secondary" onclick="clearStatsFilters()">Limpar</button>
                </div>
            </div>

            <!-- Cards de Estat√≠sticas -->
            <div class="stats-detail-grid" id="statsCards">
                <div class="stat-detail-card">
                    <h3>M√©dia Geral</h3>
                    <div class="value" id="statsAvgScore">0</div>
                    <div class="label">pontos por jogo</div>
                </div>
                <div class="stat-detail-card">
                    <h3>% Strikes</h3>
                    <div class="value" id="statsStrikePercent">0%</div>
                    <div class="label">taxa de strikes</div>
                </div>
                <div class="stat-detail-card">
                    <h3>% Spares</h3>
                    <div class="value" id="statsSparePercent">0%</div>
                    <div class="label">taxa de spares</div>
                </div>
                <div class="stat-detail-card">
                    <h3>Melhor Sequ√™ncia</h3>
                    <div class="value" id="statsBestStreak">0</div>
                    <div class="label">strikes consecutivos</div>
                </div>
                <div class="stat-detail-card">
                    <h3>Consist√™ncia</h3>
                    <div class="value" id="statsConsistency">0</div>
                    <div class="label">desvio padr√£o</div>
                </div>
                <div class="stat-detail-card">
                    <h3>M√©dia por Frame</h3>
                    <div class="value" id="statsAvgPerFrame">0</div>
                    <div class="label">pontos por frame</div>
                </div>
            </div>

            <!-- Gr√°ficos -->
            <div class="charts-grid">
                <div class="chart-container">
                    <h3 class="chart-title">üìà Evolu√ß√£o das Pontua√ß√µes</h3>
                    <div class="chart-wrapper">
                        <canvas id="lineChart"></canvas>
                    </div>
                </div>
                <div class="chart-container">
                    <h3 class="chart-title">üìä Compara√ß√£o entre Jogadores</h3>
                    <div class="chart-wrapper">
                        <canvas id="barChart"></canvas>
                    </div>
                </div>
                <div class="chart-container">
                    <h3 class="chart-title">ü•ß Distribui√ß√£o da Primeira Bola</h3>
                    <div class="chart-wrapper">
                        <canvas id="pieChart"></canvas>
                    </div>
                </div>
                <div class="chart-container">
                    <h3 class="chart-title">üìâ M√©dia por Frame</h3>
                    <div class="chart-wrapper">
                        <canvas id="frameAvgChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Ranking -->
            <div class="section-header" style="margin-top: 3rem;">
                <h2>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width: 1em; height: 1em; vertical-align: -0.125em; display: inline-block;">
                        <path d="M12 15l-4 4H4a2 2 0 0 1-2-2v-4l4-4"/>
                        <path d="M12 9l4-4h4a2 2 0 0 1 2 2v4l-4 4"/>
                        <path d="M8 15l4-4 4 4"/>
                    </svg>
                    Ranking Geral
                </h2>
            </div>
            <div class="ranking-table">
                <table>
                    <thead>
                        <tr>
                            <th class="ranking-position">#</th>
                            <th>Jogador</th>
                            <th>Partidas</th>
                            <th>M√©dia</th>
                            <th>Melhor</th>
                            <th>Strikes</th>
                            <th>Spares</th>
                        </tr>
                    </thead>
                    <tbody id="rankingBody">
                        <tr>
                            <td colspan="7" style="text-align: center; padding: 2rem; color: var(--text-muted);">
                                Nenhum dado dispon√≠vel
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>
    </div>

    <!-- ========== MODAL: JOGADOR ========== -->
    <div id="playerModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Adicionar Jogador</h2>
                <button class="modal-close" onclick="closePlayerModal()">&times;</button>
            </div>
            <form id="playerForm" onsubmit="savePlayer(event)">
                <div class="form-group">
                    <label class="form-label">Nome do Jogador</label>
                    <input type="text" id="playerName" class="form-control" required placeholder="Digite o nome...">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closePlayerModal()">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ========== MODAL: PARTIDA ========== -->
    <div id="gameModal" class="modal-overlay">
        <div class="modal" style="max-width: 900px;">
            <div class="modal-header">
                <h2 class="modal-title">Nova Partida</h2>
                <button class="modal-close" onclick="closeGameModal()">&times;</button>
            </div>
            <form id="gameForm" onsubmit="saveGame(event)">
                <div class="form-group">
                    <label class="form-label">Jogadores (pode selecionar m√∫ltiplos)</label>
                    <div id="playersCheckboxContainer" style="max-height: 150px; overflow-y: auto; padding: 0.5rem; background: var(--bg-hover); border: 1px solid var(--border); border-radius: 8px;">
                        <!-- Checkboxes ser√£o inseridos aqui via JS -->
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Data da Partida</label>
                    <input type="date" id="gameDate" class="form-control" required>
                </div>

                <!-- Entrada de Frames -->
                <div id="playersFramesContainer">
                    <!-- Frames de cada jogador ser√£o inseridos aqui -->
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeGameModal()">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Salvar Partida(s)</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ========== TEMPLATE: ENTRADA DE FRAMES PARA JOGADOR ========== -->
    <template id="playerFramesTemplate">
        <div class="player-frames-section" style="margin-bottom: 2rem; padding: 1.5rem; background: var(--bg-hover); border-radius: 12px; border: 2px solid var(--border);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 2px solid var(--primary);">
                <h3 class="player-name" style="color: var(--primary); font-size: 1.3rem; margin: 0;"></h3>
                <div style="font-size: 1.5rem; color: var(--text);">
                    <strong>Score:</strong> <span class="player-score" style="color: var(--primary); font-size: 2rem; margin-left: 0.5rem;">0</span>
                </div>
            </div>
            
            <div class="form-label" style="margin-bottom: 1rem;">
                <strong>Registre cada frame:</strong> Digite "X" para strike ou os pinos derrubados (0-10)
            </div>
                    
            <!-- Frames 1-5 -->
            <div class="frame-input-grid">
                <div class="frame-input-box" data-frame="1">
                    <label>Frame 1</label>
                    <div style="display: flex; gap: 0.25rem;">
                        <input type="text" class="frame-roll" data-frame="1" data-roll="1" maxlength="2" placeholder="1¬™">
                        <input type="text" class="frame-roll" data-frame="1" data-roll="2" maxlength="2" placeholder="2¬™">
                    </div>
                </div>
                <div class="frame-input-box" data-frame="2">
                    <label>Frame 2</label>
                    <div style="display: flex; gap: 0.25rem;">
                        <input type="text" class="frame-roll" data-frame="2" data-roll="1" maxlength="2" placeholder="1¬™">
                        <input type="text" class="frame-roll" data-frame="2" data-roll="2" maxlength="2" placeholder="2¬™">
                    </div>
                </div>
                <div class="frame-input-box" data-frame="3">
                    <label>Frame 3</label>
                    <div style="display: flex; gap: 0.25rem;">
                        <input type="text" class="frame-roll" data-frame="3" data-roll="1" maxlength="2" placeholder="1¬™">
                        <input type="text" class="frame-roll" data-frame="3" data-roll="2" maxlength="2" placeholder="2¬™">
                    </div>
                </div>
                <div class="frame-input-box" data-frame="4">
                    <label>Frame 4</label>
                    <div style="display: flex; gap: 0.25rem;">
                        <input type="text" class="frame-roll" data-frame="4" data-roll="1" maxlength="2" placeholder="1¬™">
                        <input type="text" class="frame-roll" data-frame="4" data-roll="2" maxlength="2" placeholder="2¬™">
                    </div>
                </div>
                <div class="frame-input-box" data-frame="5">
                    <label>Frame 5</label>
                    <div style="display: flex; gap: 0.25rem;">
                        <input type="text" class="frame-roll" data-frame="5" data-roll="1" maxlength="2" placeholder="1¬™">
                        <input type="text" class="frame-roll" data-frame="5" data-roll="2" maxlength="2" placeholder="2¬™">
                    </div>
                </div>
            </div>

            <!-- Frames 6-10 -->
            <div class="frame-input-grid" style="margin-top: 1rem;">
                <div class="frame-input-box" data-frame="6">
                    <label>Frame 6</label>
                    <div style="display: flex; gap: 0.25rem;">
                        <input type="text" class="frame-roll" data-frame="6" data-roll="1" maxlength="2" placeholder="1¬™">
                        <input type="text" class="frame-roll" data-frame="6" data-roll="2" maxlength="2" placeholder="2¬™">
                    </div>
                </div>
                <div class="frame-input-box" data-frame="7">
                    <label>Frame 7</label>
                    <div style="display: flex; gap: 0.25rem;">
                        <input type="text" class="frame-roll" data-frame="7" data-roll="1" maxlength="2" placeholder="1¬™">
                        <input type="text" class="frame-roll" data-frame="7" data-roll="2" maxlength="2" placeholder="2¬™">
                    </div>
                </div>
                <div class="frame-input-box" data-frame="8">
                    <label>Frame 8</label>
                    <div style="display: flex; gap: 0.25rem;">
                        <input type="text" class="frame-roll" data-frame="8" data-roll="1" maxlength="2" placeholder="1¬™">
                        <input type="text" class="frame-roll" data-frame="8" data-roll="2" maxlength="2" placeholder="2¬™">
                    </div>
                </div>
                <div class="frame-input-box" data-frame="9">
                    <label>Frame 9</label>
                    <div style="display: flex; gap: 0.25rem;">
                        <input type="text" class="frame-roll" data-frame="9" data-roll="1" maxlength="2" placeholder="1¬™">
                        <input type="text" class="frame-roll" data-frame="9" data-roll="2" maxlength="2" placeholder="2¬™">
                    </div>
                </div>
                <div class="frame-input-box" data-frame="10">
                    <label>Frame 10</label>
                    <div style="display: flex; gap: 0.25rem;">
                        <input type="text" class="frame-roll" data-frame="10" data-roll="1" maxlength="2" placeholder="1¬™">
                        <input type="text" class="frame-roll" data-frame="10" data-roll="2" maxlength="2" placeholder="2¬™">
                        <input type="text" class="frame-roll" data-frame="10" data-roll="3" maxlength="2" placeholder="3¬™">
                    </div>
                </div>
            </div>
        </div>
    </template>

    <!-- ========== TOAST CONTAINER ========== -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- ========== JAVASCRIPT ========== -->
    <script>
        // ========== CONFIGURA√á√ÉO DO FIREBASE ==========
        // IMPORTANTE: Substitua com suas credenciais do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyD2e47rsGHUdDK3cpIadNDhtN5Z0s-eXSU",
            authDomain: "bowling-brothers.firebaseapp.com",
            projectId: "bowling-brothers",
            storageBucket: "bowling-brothers.firebasestorage.app",
            messagingSenderId: "46403917625",
            appId: "1:46403917625:web:5e82d279a858cf54467ae8"
        };

        // Inicializar Firebase
        let db;
        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            
            // Habilitar cache offline
            db.enablePersistence()
                .catch((err) => {
                    if (err.code == 'failed-precondition') {
                        console.warn('M√∫ltiplas abas abertas, persist√™ncia desabilitada');
                    } else if (err.code == 'unimplemented') {
                        console.warn('Navegador n√£o suporta persist√™ncia');
                    }
                });
            
            showToast('Firebase conectado com sucesso!', 'success');
        } catch (error) {
            console.error('Erro ao inicializar Firebase:', error);
            showToast('Erro ao conectar com Firebase. Verifique as configura√ß√µes.', 'error');
        }

        // ========== VARI√ÅVEIS GLOBAIS ==========
        let players = [];
        let games = [];
        let editingPlayerId = null;
        let editingGameId = null;
        let charts = {
            line: null,
            bar: null,
            pie: null,
            frameAvg: null
        };

        // ========== NAVEGA√á√ÉO ==========
        $(document).ready(function() {
            // Navega√ß√£o entre se√ß√µes
            $('.nav-links a').on('click', function(e) {
                e.preventDefault();
                const sectionId = $(this).data('section');
                
                // Atualizar classes ativas
                $('.nav-links a').removeClass('active');
                $(this).addClass('active');
                
                $('.section').removeClass('active');
                $(`#${sectionId}`).addClass('active');
            });

            // Definir data padr√£o como hoje
            $('#gameDate').val(new Date().toISOString().split('T')[0]);

            // Listeners para frames detalhados
            $('.frame-roll').on('input', function() {
                const frame = $(this).data('frame');
                const roll = $(this).data('roll');
                const value = parseInt($(this).val()) || 0;
                
                // Validar entrada
                if (roll === 1 && value === 10 && frame < 10) {
                    // Strike - desabilitar segunda bola
                    $(this).siblings(`[data-roll="2"]`).val('').prop('disabled', true);
                } else if (roll === 1 && frame < 10) {
                    // N√£o strike - habilitar segunda bola
                    const secondRoll = $(this).siblings(`[data-roll="2"]`);
                    secondRoll.prop('disabled', false);
                    const maxSecond = 10 - value;
                    secondRoll.attr('max', maxSecond);
                }
                
                // Recalcular pontua√ß√£o
                calculateDetailedScore();
            });

            // Inicializar listeners do Firebase
            initFirebaseListeners();
        });

        // ========== FIREBASE LISTENERS ==========
        function initFirebaseListeners() {
            // Listener para jogadores
            db.collection('players').onSnapshot((snapshot) => {
                players = [];
                snapshot.forEach((doc) => {
                    players.push({ id: doc.id, ...doc.data() });
                });
                renderPlayers();
                updatePlayerSelect();
                updateStatsPlayerFilter();
                updateHomeStats();
                updateStatsView();
            }, (error) => {
                console.error('Erro ao carregar jogadores:', error);
                showToast('Erro ao carregar jogadores', 'error');
            });

            // Listener para partidas
            db.collection('games').orderBy('date', 'desc').onSnapshot((snapshot) => {
                games = [];
                snapshot.forEach((doc) => {
                    games.push({ id: doc.id, ...doc.data() });
                });
                renderGames();
                renderRecentGames();
                updateHomeStats();
                updateStatsView();
            }, (error) => {
                console.error('Erro ao carregar partidas:', error);
                showToast('Erro ao carregar partidas', 'error');
            });
        }

        // ========== CRUD: JOGADORES ==========
        function openPlayerModal(playerId = null) {
            editingPlayerId = playerId;
            
            if (playerId) {
                const player = players.find(p => p.id === playerId);
                if (player) {
                    $('#playerName').val(player.name);
                    $('.modal-title').text('Editar Jogador');
                }
            } else {
                $('#playerForm')[0].reset();
                $('.modal-title').text('Adicionar Jogador');
            }
            
            $('#playerModal').addClass('active');
        }

        function closePlayerModal() {
            $('#playerModal').removeClass('active');
            editingPlayerId = null;
            $('#playerForm')[0].reset();
        }

        async function savePlayer(event) {
            event.preventDefault();
            
            const name = $('#playerName').val().trim();
            
            if (!name) {
                showToast('Digite um nome v√°lido', 'error');
                return;
            }

            try {
                if (editingPlayerId) {
                    // Atualizar jogador existente
                    await db.collection('players').doc(editingPlayerId).update({
                        name: name,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    showToast('Jogador atualizado com sucesso!', 'success');
                } else {
                    // Criar novo jogador
                    await db.collection('players').add({
                        name: name,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    showToast('Jogador adicionado com sucesso!', 'success');
                }
                
                closePlayerModal();
            } catch (error) {
                console.error('Erro ao salvar jogador:', error);
                showToast('Erro ao salvar jogador', 'error');
            }
        }

        async function deletePlayer(playerId) {
            if (!confirm('Tem certeza que deseja excluir este jogador?')) {
                return;
            }

            try {
                // Verificar se h√° partidas do jogador
                const gamesSnapshot = await db.collection('games').where('playerId', '==', playerId).get();
                
                if (!gamesSnapshot.empty) {
                    if (!confirm('Este jogador possui partidas registradas. Deseja excluir mesmo assim?')) {
                        return;
                    }
                    
                    // Excluir todas as partidas do jogador
                    const batch = db.batch();
                    gamesSnapshot.docs.forEach((doc) => {
                        batch.delete(doc.ref);
                    });
                    await batch.commit();
                }
                
                // Excluir jogador
                await db.collection('players').doc(playerId).delete();
                showToast('Jogador exclu√≠do com sucesso!', 'success');
            } catch (error) {
                console.error('Erro ao excluir jogador:', error);
                showToast('Erro ao excluir jogador', 'error');
            }
        }

        function renderPlayers() {
            const container = $('#playersList');
            
            if (players.length === 0) {
                container.html(`
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--text-muted); width: 64px; height: 64px;">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                            <circle cx="9" cy="7" r="4"/>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                        </svg>
                        <h3>Nenhum jogador cadastrado</h3>
                        <p>Comece adicionando seu primeiro jogador</p>
                    </div>
                `);
                return;
            }

            const html = players.map(player => {
                const playerGames = games.filter(g => g.playerId === player.id);
                const totalGames = playerGames.length;
                const avgScore = totalGames > 0 
                    ? Math.round(playerGames.reduce((sum, g) => sum + g.finalScore, 0) / totalGames)
                    : 0;
                const bestScore = totalGames > 0
                    ? Math.max(...playerGames.map(g => g.finalScore))
                    : 0;

                return `
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">${player.name}</div>
                            <div class="card-actions">
                                <button class="btn btn-icon" onclick="openPlayerModal('${player.id}')" title="Editar">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                                    </svg>
                                </button>
                                <button class="btn btn-icon" onclick="deletePlayer('${player.id}')" title="Excluir">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <polyline points="3 6 5 6 21 6"/>
                                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                                        <line x1="10" y1="11" x2="10" y2="17"/>
                                        <line x1="14" y1="11" x2="14" y2="17"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="card-stat">
                                <span class="card-stat-label">Partidas</span>
                                <span class="card-stat-value">${totalGames}</span>
                            </div>
                            <div class="card-stat">
                                <span class="card-stat-label">M√©dia</span>
                                <span class="card-stat-value">${avgScore}</span>
                            </div>
                            <div class="card-stat">
                                <span class="card-stat-label">Melhor</span>
                                <span class="card-stat-value">${bestScore}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            container.html(html);
        }

        function updatePlayerSelect() {
            const select = $('#gamePlayer');
            const currentValue = select.val();
            
            select.html('<option value="">Selecione um jogador...</option>');
            
            players.forEach(player => {
                select.append(`<option value="${player.id}">${player.name}</option>`);
            });
            
            if (currentValue) {
                select.val(currentValue);
            }
        }

        // ========== FUN√á√ïES DE M√öLTIPLOS JOGADORES ==========
        function renderPlayerCheckboxes() {
            const container = $('#playersCheckboxContainer');
            container.empty();
            
            if (players.length === 0) {
                container.html('<p style="color: var(--text-muted); padding: 1rem;">Nenhum jogador dispon√≠vel. Adicione jogadores primeiro.</p>');
                return;
            }
            
            players.forEach(player => {
                const item = $(`
                    <div class="player-checkbox-item">
                        <input type="checkbox" id="player_${player.id}" value="${player.id}" onchange="updatePlayerFramesInputs()">
                        <label for="player_${player.id}">${player.name}</label>
                    </div>
                `);
                container.append(item);
            });
        }

        function updatePlayerFramesInputs() {
            const container = $('#playersFramesContainer');
            container.empty();
            
            // Pegar jogadores selecionados
            const selectedPlayers = [];
            $('#playersCheckboxContainer input[type="checkbox"]:checked').each(function() {
                const playerId = $(this).val();
                const player = players.find(p => p.id === playerId);
                if (player) {
                    selectedPlayers.push(player);
                }
            });
            
            if (selectedPlayers.length === 0) {
                return;
            }
            
            // Criar se√ß√£o de frames para cada jogador
            selectedPlayers.forEach(player => {
                const template = $('#playerFramesTemplate').html();
                const playerSection = $(template);
                
                // Configurar nome e ID
                playerSection.attr('data-player-id', player.id);
                playerSection.find('.player-name').text(player.name);
                
                // Adicionar listeners aos inputs de frames
                playerSection.find('.frame-roll').on('input', function() {
                    handleFrameInput($(this), player.id);
                });
                
                container.append(playerSection);
            });
        }

        function handleFrameInput(input, playerId) {
            const frame = input.data('frame');
            const roll = input.data('roll');
            let value = input.val().toUpperCase().trim();
            
            // N√£o permitir / no primeiro slot
            if (roll === 1 && value === '/') {
                input.val('');
                showToast('O s√≠mbolo / (spare) s√≥ pode ser usado no segundo slot', 'error');
                return;
            }
            
            // Converter X para 10
            if (value === 'X') {
                value = '10';
            }
            
            // Validar entrada - apenas n√∫meros de 0-10 ou / para spare
            if (value !== '' && value !== '/') {
                const numValue = parseInt(value);
                if (isNaN(numValue) || numValue < 0 || numValue > 10) {
                    input.val('');
                    showToast('Digite um n√∫mero entre 0 e 10, ou X para strike', 'error');
                    return;
                }
                value = numValue.toString();
            }
            
            // Atualizar valor
            input.val(value);
            
            // Valida√ß√µes espec√≠ficas por frame
            if (frame < 10) {
                const roll1Input = input.closest('.frame-input-box').find('[data-roll="1"]');
                const roll2Input = input.closest('.frame-input-box').find('[data-roll="2"]');
                
                const roll1Val = roll1Input.val();
                const roll2Val = roll2Input.val();
                
                if (roll === 1) {
                    // Primeira bola
                    if (value === '10') {
                        // Strike - transformar em X e desabilitar segunda bola
                        input.val('X');
                        roll2Input.val('').prop('disabled', true);
                    } else {
                        // N√£o strike - habilitar segunda bola
                        roll2Input.prop('disabled', false);
                    }
                } else if (roll === 2) {
                    // Segunda bola
                    const roll1Num = roll1Val === 'X' ? 10 : (parseInt(roll1Val) || 0);
                    
                    if (value === '/') {
                        // Spare - permitir
                    } else {
                        const roll2Num = parseInt(value) || 0;
                        const total = roll1Num + roll2Num;
                        
                        if (total > 10) {
                            input.val('');
                            showToast(`A soma das bolas n√£o pode passar de 10 (${roll1Num} + ${roll2Num} = ${total})`, 'error');
                            return;
                        } else if (total === 10) {
                            // Spare - transformar em /
                            input.val('/');
                        }
                    }
                }
            } else {
                // Frame 10 - regras especiais
                const roll1Input = input.closest('.frame-input-box').find('[data-roll="1"]');
                const roll2Input = input.closest('.frame-input-box').find('[data-roll="2"]');
                const roll3Input = input.closest('.frame-input-box').find('[data-roll="3"]');
                
                const roll1Val = roll1Input.val();
                const roll2Val = roll2Input.val();
                
                if (roll === 1) {
                    if (value === '10') {
                        roll1Input.val('X');
                        roll2Input.prop('disabled', false);
                        roll3Input.prop('disabled', false);
                    } else {
                        roll2Input.prop('disabled', false);
                    }
                } else if (roll === 2) {
                    const roll1Num = roll1Val === 'X' ? 10 : (parseInt(roll1Val) || 0);
                    
                    if (roll1Num === 10) {
                        // Ap√≥s strike, pode derrubar 10 novamente
                        if (value === '10') {
                            roll2Input.val('X');
                        }
                        roll3Input.prop('disabled', false);
                    } else {
                        // Ap√≥s n√£o-strike
                        if (value === '/') {
                            roll3Input.prop('disabled', false);
                        } else {
                            const roll2Num = parseInt(value) || 0;
                            const total = roll1Num + roll2Num;
                            
                            if (total > 10) {
                                input.val('');
                                showToast(`A soma n√£o pode passar de 10`, 'error');
                                return;
                            } else if (total === 10) {
                                roll2Input.val('/');
                                roll3Input.prop('disabled', false);
                            } else {
                                roll3Input.val('').prop('disabled', true);
                            }
                        }
                    }
                } else if (roll === 3) {
                    const roll1Num = roll1Val === 'X' ? 10 : (parseInt(roll1Val) || 0);
                    const roll2Num = roll2Val === 'X' ? 10 : (roll2Val === '/' ? (10 - roll1Num) : (parseInt(roll2Val) || 0));
                    
                    if (roll2Val === 'X' || roll2Val === '/') {
                        // Pode derrubar 10
                        if (value === '10') {
                            roll3Input.val('X');
                        }
                    } else {
                        // Validar baseado na segunda bola
                        const roll3Num = parseInt(value) || 0;
                        if (roll2Num + roll3Num > 10) {
                            input.val('');
                            showToast(`A soma n√£o pode passar de 10`, 'error');
                            return;
                        }
                    }
                }
            }
            
            // Recalcular pontua√ß√£o do jogador
            calculatePlayerScore(playerId);
        }

        function calculatePlayerScore(playerId, providedFrames = null) {
            let frames = [];
            
            // Se frames foram fornecidos (ex: do OCR), usar eles
            if (providedFrames) {
                frames = providedFrames;
            } else {
                // Caso contr√°rio, coletar dos inputs do DOM
                const playerSection = $(`.player-frames-section[data-player-id="${playerId}"]`);
                
                // Coletar dados dos frames
                for (let i = 1; i <= 10; i++) {
                    const frameBox = playerSection.find(`[data-frame="${i}"]`).closest('.frame-input-box');
                    const rolls = [];
                    const frame = {};
                    
                    if (i < 10) {
                        const roll1Val = frameBox.find('[data-roll="1"]').val();
                        const roll2Val = frameBox.find('[data-roll="2"]').val();
                        
                        const roll1 = roll1Val === 'X' ? 10 : (parseInt(roll1Val) || 0);
                        const roll2 = roll2Val === '/' ? (10 - roll1) : (parseInt(roll2Val) || 0);
                        
                        rolls.push(roll1);
                        if (roll1 < 10) {
                            rolls.push(roll2);
                        }
                        
                        frame.frame = i;
                        frame.rolls = rolls;
                        
                        if (roll1 === 10) {
                            frame.type = 'strike';
                        } else if (roll1 + roll2 === 10) {
                            frame.type = 'spare';
                        } else {
                            frame.type = 'open';
                        }
                    } else {
                        // Frame 10
                        const roll1Val = frameBox.find('[data-roll="1"]').val();
                        const roll2Val = frameBox.find('[data-roll="2"]').val();
                        const roll3Val = frameBox.find('[data-roll="3"]').val();
                        
                        const roll1 = roll1Val === 'X' ? 10 : (parseInt(roll1Val) || 0);
                        let roll2 = 0;
                        let roll3 = 0;
                        
                        if (roll1 === 10) {
                            roll2 = roll2Val === 'X' ? 10 : (parseInt(roll2Val) || 0);
                            if (roll2 === 10) {
                                roll3 = roll3Val === 'X' ? 10 : (parseInt(roll3Val) || 0);
                            } else {
                                roll3 = roll3Val === '/' ? (10 - roll2) : (parseInt(roll3Val) || 0);
                            }
                        } else {
                            roll2 = roll2Val === '/' ? (10 - roll1) : (parseInt(roll2Val) || 0);
                            if (roll1 + roll2 === 10) {
                                roll3 = roll3Val === 'X' ? 10 : (parseInt(roll3Val) || 0);
                            }
                        }
                        
                        rolls.push(roll1);
                        if (roll1 === 10 || roll1 + roll2 >= 10) {
                            rolls.push(roll2);
                            if (roll1 === 10 || roll1 + roll2 >= 10) {
                                if (roll3 > 0) rolls.push(roll3);
                            }
                        } else if (roll1 < 10) {
                            rolls.push(roll2);
                        }
                        
                        frame.frame = 10;
                        frame.rolls = rolls;
                        frame.type = roll1 === 10 ? 'strike' : (roll1 + roll2 >= 10 ? 'spare' : 'open');
                    }
                    
                    frames.push(frame);
                }
            }
            
            // Calcular pontua√ß√£o
            const score = calculateBowlingScore(frames);
            
            // Atualizar UI apenas se n√£o foram frames fornecidos (ou seja, est√° calculando do DOM)
            if (!providedFrames) {
                const playerSection = $(`.player-frames-section[data-player-id="${playerId}"]`);
                playerSection.find('.player-score').text(score);
            }
            
            return { frames, score };
        }



        function calculateBowlingScore(frames) {
            let totalScore = 0;
            let rollIndex = 0;
            const allRolls = [];
            
            // Flatten all rolls
            frames.forEach(frame => {
                allRolls.push(...frame.rolls);
            });
            
            for (let frameIndex = 0; frameIndex < 10; frameIndex++) {
                if (allRolls[rollIndex] === 10) {
                    // Strike
                    totalScore += 10 + (allRolls[rollIndex + 1] || 0) + (allRolls[rollIndex + 2] || 0);
                    rollIndex++;
                } else if ((allRolls[rollIndex] || 0) + (allRolls[rollIndex + 1] || 0) === 10) {
                    // Spare
                    totalScore += 10 + (allRolls[rollIndex + 2] || 0);
                    rollIndex += 2;
                } else {
                    // Open frame
                    totalScore += (allRolls[rollIndex] || 0) + (allRolls[rollIndex + 1] || 0);
                    rollIndex += 2;
                }
            }
            
            return totalScore;
        }

        // ========== CRUD: PARTIDAS ==========
        function openGameModal(gameId = null) {
            editingGameId = gameId;
            
            // Renderizar checkboxes de jogadores
            renderPlayerCheckboxes();
            
            if (gameId) {
                // Modo edi√ß√£o ainda n√£o suportado para m√∫ltiplos jogadores
                showToast('Edi√ß√£o de partidas ainda n√£o dispon√≠vel', 'warning');
                return;
            } else {
                $('#gameForm')[0].reset();
                $('#gameDate').val(new Date().toISOString().split('T')[0]);
                $('.modal-title').text('Nova Partida');
                $('#playersFramesContainer').empty();
            }
            
            $('#gameModal').addClass('active');
        }

        function closeGameModal() {
            $('#gameModal').removeClass('active');
            editingGameId = null;
            $('#gameForm')[0].reset();
            $('#playersFramesContainer').empty();
        }

        async function saveGame(event) {
            event.preventDefault();
            
            const date = $('#gameDate').val();

            if (!date) {
                showToast('Selecione uma data para a partida', 'error');
                return;
            }

            // Coletar dados de todos os jogadores selecionados
            const selectedPlayers = [];
            $('#playersCheckboxContainer input[type="checkbox"]:checked').each(function() {
                selectedPlayers.push($(this).val());
            });

            if (selectedPlayers.length === 0) {
                showToast('Selecione pelo menos um jogador', 'error');
                return;
            }

            const gamesToSave = [];
            let hasErrors = false;

            // Validar e coletar dados de cada jogador
            selectedPlayers.forEach(playerId => {
                const result = calculatePlayerScore(playerId);
                
                if (result.score === 0 && result.frames[0].rolls.length === 0) {
                    showToast('Preencha pelo menos o primeiro frame de todos os jogadores', 'error');
                    hasErrors = true;
                    return;
                }
                
                gamesToSave.push({
                    playerId: playerId,
                    date: date,
                    frames: result.frames,
                    finalScore: result.score,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
            });

            if (hasErrors) {
                return;
            }

            // Salvar m√∫ltiplas partidas em batch
            try {
                const batch = db.batch();
                
                gamesToSave.forEach(gameData => {
                    const newGameRef = db.collection('games').doc();
                    batch.set(newGameRef, gameData);
                });

                await batch.commit();
                
                const playerCount = gamesToSave.length;
                showToast(`${playerCount} partida${playerCount > 1 ? 's' : ''} salva${playerCount > 1 ? 's' : ''} com sucesso!`, 'success');
                closeGameModal();
            } catch (error) {
                console.error('Erro ao salvar partidas:', error);
                showToast('Erro ao salvar partidas', 'error');
            }
        }

        async function deleteGame(gameId) {
            if (!confirm('Tem certeza que deseja excluir esta partida?')) {
                return;
            }

            try {
                await db.collection('games').doc(gameId).delete();
                showToast('Partida exclu√≠da com sucesso!', 'success');
            } catch (error) {
                console.error('Erro ao excluir partida:', error);
                showToast('Erro ao excluir partida', 'error');
            }
        }

        function renderGames() {
            const container = $('#gamesList');
            
            if (games.length === 0) {
                container.html(`
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--text-muted); width: 64px; height: 64px;">
                            <circle cx="12" cy="12" r="10"/>
                            <circle cx="12" cy="12" r="3"/>
                            <circle cx="12" cy="8" r="1"/>
                            <circle cx="8" cy="14" r="1"/>
                            <circle cx="16" cy="14" r="1"/>
                        </svg>
                        <h3>Nenhuma partida registrada</h3>
                        <p>Comece registrando sua primeira partida</p>
                    </div>
                `);
                return;
            }

            const html = games.map(game => {
                const player = players.find(p => p.id === game.playerId);
                const playerName = player ? player.name : 'Desconhecido';
                const formattedDate = new Date(game.date).toLocaleDateString('pt-BR');
                
                // Calcular estat√≠sticas se houver frames
                let stats = '';
                if (game.frames && game.frames.length > 0) {
                    const strikes = game.frames.filter(f => f.type === 'strike').length;
                    const spares = game.frames.filter(f => f.type === 'spare').length;
                    stats = `
                        <div class="card-stat">
                            <span class="card-stat-label">Strikes</span>
                            <span class="card-stat-value" style="color: var(--success);">${strikes}</span>
                        </div>
                        <div class="card-stat">
                            <span class="card-stat-label">Spares</span>
                            <span class="card-stat-value" style="color: var(--secondary);">${spares}</span>
                        </div>
                    `;
                }

                return `
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">${playerName}</div>
                            <div class="card-actions">
                                <button class="btn btn-icon" onclick="openGameModal('${game.id}')" title="Editar">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                                    </svg>
                                </button>
                                <button class="btn btn-icon" onclick="deleteGame('${game.id}')" title="Excluir">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <polyline points="3 6 5 6 21 6"/>
                                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                                        <line x1="10" y1="11" x2="10" y2="17"/>
                                        <line x1="14" y1="11" x2="14" y2="17"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="card-stat">
                                <span class="card-stat-label">Data</span>
                                <span class="card-stat-value">${formattedDate}</span>
                            </div>
                            <div class="card-stat">
                                <span class="card-stat-label">Pontua√ß√£o</span>
                                <span class="card-stat-value" style="color: var(--primary); font-size: 1.5rem;">${game.finalScore}</span>
                            </div>
                            ${stats}
                        </div>
                    </div>
                `;
            }).join('');

            container.html(html);
        }

        function renderRecentGames() {
            const container = $('#recentGames');
            const recentGames = games.slice(0, 6);
            
            if (recentGames.length === 0) {
                container.html(`
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--text-muted); width: 64px; height: 64px;">
                            <circle cx="12" cy="12" r="10"/>
                            <circle cx="12" cy="12" r="3"/>
                            <circle cx="12" cy="8" r="1"/>
                            <circle cx="8" cy="14" r="1"/>
                            <circle cx="16" cy="14" r="1"/>
                        </svg>
                        <h3>Nenhuma partida ainda</h3>
                        <p>Comece registrando partidas para ver o hist√≥rico</p>
                    </div>
                `);
                return;
            }

            const html = recentGames.map(game => {
                const player = players.find(p => p.id === game.playerId);
                const playerName = player ? player.name : 'Desconhecido';
                const formattedDate = new Date(game.date).toLocaleDateString('pt-BR');

                return `
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">${playerName}</div>
                        </div>
                        <div class="card-body">
                            <div class="card-stat">
                                <span class="card-stat-label">Data</span>
                                <span class="card-stat-value">${formattedDate}</span>
                            </div>
                            <div class="card-stat">
                                <span class="card-stat-label">Pontua√ß√£o</span>
                                <span class="card-stat-value" style="color: var(--primary); font-size: 1.5rem;">${game.finalScore}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            container.html(html);
        }

        // ========== ESTAT√çSTICAS DA HOME ==========
        function updateHomeStats() {
            // Total de jogadores
            $('#totalPlayers').text(players.length);

            // Total de partidas
            $('#totalGames').text(games.length);

            // M√©dia geral
            if (games.length > 0) {
                const avgScore = Math.round(games.reduce((sum, g) => sum + g.finalScore, 0) / games.length);
                $('#avgScore').text(avgScore);
            } else {
                $('#avgScore').text('0');
            }

            // Melhor pontua√ß√£o
            if (games.length > 0) {
                const bestScore = Math.max(...games.map(g => g.finalScore));
                $('#bestScore').text(bestScore);
            } else {
                $('#bestScore').text('0');
            }
        }

        // ========== TOAST NOTIFICATIONS ==========
        function showToast(message, type = 'info') {
            const toast = $(`
                <div class="toast ${type}">
                    ${message}
                </div>
            `);

            $('#toastContainer').append(toast);

            setTimeout(() => {
                toast.fadeOut(300, function() {
                    $(this).remove();
                });
            }, 3000);
        }

        // ========== ESTAT√çSTICAS E GR√ÅFICOS ==========
        function updateStatsView() {
            const selectedPlayer = $('#statsPlayerFilter').val();
            const dateFrom = $('#statsDateFrom').val();
            const dateTo = $('#statsDateTo').val();
            
            // Filtrar partidas
            let filteredGames = games.filter(g => g.frames && g.frames.length > 0);
            
            if (selectedPlayer) {
                filteredGames = filteredGames.filter(g => g.playerId === selectedPlayer);
            }
            
            if (dateFrom) {
                filteredGames = filteredGames.filter(g => g.date >= dateFrom);
            }
            
            if (dateTo) {
                filteredGames = filteredGames.filter(g => g.date <= dateTo);
            }
            
            // Calcular estat√≠sticas
            calculateAndDisplayStats(filteredGames);
            
            // Atualizar gr√°ficos
            updateCharts(filteredGames);
            
            // Atualizar ranking
            updateRanking();
        }

        function calculateAndDisplayStats(filteredGames) {
            if (filteredGames.length === 0) {
                $('#statsAvgScore').text('0');
                $('#statsStrikePercent').text('0%');
                $('#statsSparePercent').text('0%');
                $('#statsBestStreak').text('0');
                $('#statsConsistency').text('0');
                $('#statsAvgPerFrame').text('0');
                return;
            }
            
            // M√©dia geral
            const avgScore = Math.round(filteredGames.reduce((sum, g) => sum + g.finalScore, 0) / filteredGames.length);
            $('#statsAvgScore').text(avgScore);
            
            // Contar frames
            let totalFrames = 0;
            let strikes = 0;
            let spares = 0;
            let opens = 0;
            let allScores = [];
            let maxStreak = 0;
            let currentStreak = 0;
            
            filteredGames.forEach(game => {
                allScores.push(game.finalScore);
                game.frames.forEach((frame, idx) => {
                    if (idx < 10) totalFrames++;
                    
                    if (frame.type === 'strike') {
                        strikes++;
                        currentStreak++;
                        maxStreak = Math.max(maxStreak, currentStreak);
                    } else {
                        currentStreak = 0;
                        if (frame.type === 'spare') {
                            spares++;
                        } else {
                            opens++;
                        }
                    }
                });
            });
            
            // Percentuais
            const strikePercent = totalFrames > 0 ? Math.round((strikes / totalFrames) * 100) : 0;
            const sparePercent = totalFrames > 0 ? Math.round((spares / totalFrames) * 100) : 0;
            
            $('#statsStrikePercent').text(strikePercent + '%');
            $('#statsSparePercent').text(sparePercent + '%');
            $('#statsBestStreak').text(maxStreak);
            
            // Consist√™ncia (desvio padr√£o)
            const mean = allScores.reduce((a, b) => a + b, 0) / allScores.length;
            const variance = allScores.reduce((sum, score) => sum + Math.pow(score - mean, 2), 0) / allScores.length;
            const stdDev = Math.round(Math.sqrt(variance));
            $('#statsConsistency').text(stdDev);
            
            // M√©dia por frame
            const avgPerFrame = totalFrames > 0 ? (avgScore / 10).toFixed(1) : 0;
            $('#statsAvgPerFrame').text(avgPerFrame);
        }

        function updateCharts(filteredGames) {
            // Destruir gr√°ficos anteriores
            Object.values(charts).forEach(chart => {
                if (chart) chart.destroy();
            });
            
            if (filteredGames.length === 0) return;
            
            // Preparar dados
            const playerData = {};
            filteredGames.forEach(game => {
                const player = players.find(p => p.id === game.playerId);
                const playerName = player ? player.name : 'Desconhecido';
                
                if (!playerData[playerName]) {
                    playerData[playerName] = {
                        scores: [],
                        dates: [],
                        strikes: 0,
                        spares: 0,
                        firstBalls: []
                    };
                }
                
                playerData[playerName].scores.push(game.finalScore);
                playerData[playerName].dates.push(new Date(game.date).toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' }));
                
                if (game.frames) {
                    game.frames.forEach(frame => {
                        if (frame.type === 'strike') playerData[playerName].strikes++;
                        if (frame.type === 'spare') playerData[playerName].spares++;
                        if (frame.rolls && frame.rolls.length > 0) {
                            playerData[playerName].firstBalls.push(frame.rolls[0]);
                        }
                    });
                }
            });
            
            // Gr√°fico de linha - Evolu√ß√£o
            createLineChart(playerData);
            
            // Gr√°fico de barras - Compara√ß√£o
            createBarChart(playerData);
            
            // Gr√°fico de pizza - Primeira bola
            createPieChart(playerData);
            
            // Gr√°fico de m√©dia por frame
            createFrameAvgChart(filteredGames);
        }

        function createLineChart(playerData) {
            const ctx = document.getElementById('lineChart');
            if (!ctx) return;
            
            const colors = ['#ff3366', '#00d9ff', '#00ff88', '#ffaa00', '#9966ff'];
            const datasets = Object.keys(playerData).map((playerName, idx) => ({
                label: playerName,
                data: playerData[playerName].scores,
                borderColor: colors[idx % colors.length],
                backgroundColor: colors[idx % colors.length] + '20',
                tension: 0.4,
                fill: true
            }));
            
            const allDates = Object.values(playerData).flatMap(p => p.dates);
            const uniqueDates = [...new Set(allDates)].sort();
            
            charts.line = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: uniqueDates.slice(-10), // √öltimas 10 datas
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#e5e5e5' }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 300,
                            ticks: { color: '#999' },
                            grid: { color: '#333' }
                        },
                        x: {
                            ticks: { color: '#999' },
                            grid: { color: '#333' }
                        }
                    }
                }
            });
        }

        function createBarChart(playerData) {
            const ctx = document.getElementById('barChart');
            if (!ctx) return;
            
            const playerNames = Object.keys(playerData);
            const avgScores = playerNames.map(name => {
                const scores = playerData[name].scores;
                return Math.round(scores.reduce((a, b) => a + b, 0) / scores.length);
            });
            
            charts.bar = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: playerNames,
                    datasets: [{
                        label: 'M√©dia de Pontua√ß√£o',
                        data: avgScores,
                        backgroundColor: [
                            '#ff3366',
                            '#00d9ff',
                            '#00ff88',
                            '#ffaa00',
                            '#9966ff'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#e5e5e5' }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 300,
                            ticks: { color: '#999' },
                            grid: { color: '#333' }
                        },
                        x: {
                            ticks: { color: '#999' },
                            grid: { color: '#333' }
                        }
                    }
                }
            });
        }

        function createPieChart(playerData) {
            const ctx = document.getElementById('pieChart');
            if (!ctx) return;
            
            // Distribui√ß√£o da primeira bola (0-10 pinos)
            const distribution = new Array(11).fill(0);
            Object.values(playerData).forEach(data => {
                data.firstBalls.forEach(pins => {
                    if (pins >= 0 && pins <= 10) {
                        distribution[pins]++;
                    }
                });
            });
            
            charts.pie = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '10 (Strike)'],
                    datasets: [{
                        data: distribution,
                        backgroundColor: [
                            '#ff3366',
                            '#ff4477',
                            '#ff5588',
                            '#ff6699',
                            '#00d9ff',
                            '#00bbdd',
                            '#009dbb',
                            '#007f99',
                            '#00ff88',
                            '#00dd77',
                            '#00bb66'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: { color: '#e5e5e5', font: { size: 10 } }
                        }
                    }
                }
            });
        }

        function createFrameAvgChart(filteredGames) {
            const ctx = document.getElementById('frameAvgChart');
            if (!ctx) return;
            
            // Calcular m√©dia por frame
            const frameAvgs = new Array(10).fill(0);
            const frameCounts = new Array(10).fill(0);
            
            filteredGames.forEach(game => {
                if (game.frames) {
                    game.frames.forEach((frame, idx) => {
                        if (idx < 10 && frame.rolls) {
                            const frameScore = frame.rolls.reduce((a, b) => a + b, 0);
                            frameAvgs[idx] += frameScore;
                            frameCounts[idx]++;
                        }
                    });
                }
            });
            
            const averages = frameAvgs.map((sum, idx) => 
                frameCounts[idx] > 0 ? (sum / frameCounts[idx]).toFixed(1) : 0
            );
            
            charts.frameAvg = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10'],
                    datasets: [{
                        label: 'M√©dia de Pinos por Frame',
                        data: averages,
                        backgroundColor: '#00d9ff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#e5e5e5' }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 10,
                            ticks: { color: '#999' },
                            grid: { color: '#333' }
                        },
                        x: {
                            ticks: { color: '#999' },
                            grid: { color: '#333' }
                        }
                    }
                }
            });
        }

        function updateRanking() {
            const tbody = $('#rankingBody');
            
            if (players.length === 0) {
                tbody.html(`
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 2rem; color: var(--text-muted);">
                            Nenhum dado dispon√≠vel
                        </td>
                    </tr>
                `);
                return;
            }
            
            // Calcular estat√≠sticas por jogador
            const playerStats = players.map(player => {
                const playerGames = games.filter(g => g.playerId === player.id && g.frames);
                
                if (playerGames.length === 0) {
                    return {
                        name: player.name,
                        gamesCount: 0,
                        avgScore: 0,
                        bestScore: 0,
                        strikes: 0,
                        spares: 0
                    };
                }
                
                const avgScore = Math.round(
                    playerGames.reduce((sum, g) => sum + g.finalScore, 0) / playerGames.length
                );
                const bestScore = Math.max(...playerGames.map(g => g.finalScore));
                
                let strikes = 0;
                let spares = 0;
                
                playerGames.forEach(game => {
                    if (game.frames) {
                        game.frames.forEach(frame => {
                            if (frame.type === 'strike') strikes++;
                            if (frame.type === 'spare') spares++;
                        });
                    }
                });
                
                return {
                    name: player.name,
                    gamesCount: playerGames.length,
                    avgScore,
                    bestScore,
                    strikes,
                    spares
                };
            });
            
            // Ordenar por m√©dia
            playerStats.sort((a, b) => b.avgScore - a.avgScore);
            
            // Renderizar
            const html = playerStats.map((stat, idx) => {
                let positionClass = '';
                if (idx === 0) positionClass = 'first';
                else if (idx === 1) positionClass = 'second';
                else if (idx === 2) positionClass = 'third';
                
                return `
                    <tr>
                        <td class="ranking-position ${positionClass}">${idx + 1}</td>
                        <td><strong>${stat.name}</strong></td>
                        <td>${stat.gamesCount}</td>
                        <td><strong>${stat.avgScore}</strong></td>
                        <td>${stat.bestScore}</td>
                        <td style="color: var(--success);">${stat.strikes}</td>
                        <td style="color: var(--secondary);">${stat.spares}</td>
                    </tr>
                `;
            }).join('');
            
            tbody.html(html);
        }

        function clearStatsFilters() {
            $('#statsPlayerFilter').val('');
            $('#statsDateFrom').val('');
            $('#statsDateTo').val('');
            updateStatsView();
        }

        function updateStatsPlayerFilter() {
            const select = $('#statsPlayerFilter');
            const currentValue = select.val();
            
            select.html('<option value="">Todos os jogadores</option>');
            
            players.forEach(player => {
                select.append(`<option value="${player.id}">${player.name}</option>`);
            });
            
            if (currentValue) {
                select.val(currentValue);
            }
        }

        // ========== FECHAR MODAL AO CLICAR FORA ==========
        $('.modal-overlay').on('click', function(e) {
            if (e.target === this) {
                $(this).removeClass('active');
                editingPlayerId = null;
                editingGameId = null;
            }
        });
    </script>
</body>
</html>
